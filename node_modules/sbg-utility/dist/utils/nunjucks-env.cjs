'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var nunjucks = require('nunjucks');
var encodeUrl = require('./encode-url.cjs');

function envNunjucks(loader, opts) {
  const env = new nunjucks.Environment(loader, opts);
  env.addFilter('uriencode', str => {
    return encodeUrl.encodeURL(str);
  });
  env.addFilter('noControlChars', str => {
    return str.replace(/[\x00-\x1F\x7F]/g, ''); // eslint-disable-line no-control-regex
  });
  // Extract date from datetime
  env.addFilter('formatDate', input => {
    // Check if input is a Moment instance
    if (input && typeof input === 'object' && 'toISOString' in input && typeof input.toISOString === 'function') {
      return input.toISOString().substring(0, 10);
    }
    // Handle Date instance
    if (input instanceof Date) {
      return input.toISOString().substring(0, 10);
    }
    // Handle string input (try to parse as date)
    if (typeof input === 'string') {
      const date = new Date(input);
      if (!isNaN(date.getTime())) {
        return date.toISOString().substring(0, 10);
      }
    }
    // Fallback: return input as string or empty string
    return String(input || '');
  });
  return env;
}

exports.default = envNunjucks;
exports.envNunjucks = envNunjucks;
